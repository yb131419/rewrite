<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LINE LIFF 文案自動改寫工具</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: 'Helvetica Neue', sans-serif;
      margin: 0; padding: 20px;
      background-color: #1f2937;
      color: #f9fafb;
      font-size: 16px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    h1 {
      text-align: center;
      color: #f9fafb;
      margin-bottom: 20px;
    }
    textarea {
      width: 100%;
      height: 140px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #6b7280;
      background-color: #111827;
      color: #f9fafb;
      font-size: 16px;
      box-sizing: border-box;
      resize: vertical;
    }
    button {
      width: 100%;
      padding: 14px;
      margin-top: 15px;
      border-radius: 8px;
      border: none;
      background-color: #06c755;
      color: #f9fafb;
      font-weight: bold;
      font-size: 18px;
      cursor: pointer;
      box-sizing: border-box;
    }
    button:disabled {
      background-color: #4b5563;
      cursor: not-allowed;
    }
    #clearBtn, #shareBtn {
      background-color: #2563eb;
      margin-top: 10px;
    }
    #clearBtn:disabled, #shareBtn:disabled {
      background-color: #4b5563;
    }
    #statusMsg {
      margin-top: 15px;
      min-height: 24px;
      text-align: center;
    }
  </style>
</head>
<body>

<h1>LINE LIFF 文案自動改寫工具</h1>

<textarea id="inputText" placeholder="請輸入要改寫的文案..." autocomplete="off"></textarea>
<button id="rewriteBtn">改寫文案</button>
<button id="clearBtn" disabled>清除</button>
<button id="shareBtn" disabled>分享到 LINE 聊天室</button>

<div id="statusMsg"></div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbwRYOIicltP81EO6fQB81bCRfoEczp29qqqSbz5HjdzbsZmRrccQgxR6QmikAWuuNGl/exec";
  const LIFF_ID = "2007416974-JzvPy6DZ";

  const inputText = document.getElementById("inputText");
  const rewriteBtn = document.getElementById("rewriteBtn");
  const clearBtn = document.getElementById("clearBtn");
  const shareBtn = document.getElementById("shareBtn");
  const statusMsg = document.getElementById("statusMsg");

  let rewrittenText = "";
  let userId = "";

  // 初始化 LIFF
  window.onload = () => {
    liff.init({ liffId: LIFF_ID })
      .then(() => {
        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          liff.getProfile()
            .then(profile => {
              userId = profile.userId;
            })
            .catch(() => {
              userId = "";
            });
        }
      })
      .catch(err => {
        statusMsg.style.color = "red";
        statusMsg.textContent = "⚠️ LIFF 初始化失敗：" + err;
      });
  };

  // 改寫按鈕點擊事件
  rewriteBtn.addEventListener("click", () => {
    const text = inputText.value.trim();
    if (!text) {
      statusMsg.style.color = "red";
      statusMsg.textContent = "請輸入文案";
      return;
    }

    statusMsg.style.color = "#f9fafb";
    statusMsg.textContent = "改寫中...";
    rewriteBtn.disabled = true;

    fetch(scriptURL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        text: text,
        userId: userId
      })
    })
    .then(res => res.json())
    .then(data => {
      rewriteBtn.disabled = false;
      if (data.success && data.result) {
        rewrittenText = data.result;
        inputText.value = rewrittenText;
        statusMsg.style.color = "lightgreen";
        statusMsg.textContent = "✅ 改寫成功！";
        clearBtn.disabled = false;
        shareBtn.disabled = false;
      } else {
        statusMsg.style.color = "red";
        statusMsg.textContent = "❌ 改寫失敗：" + (data.message || "未知錯誤");
      }
    })
    .catch(() => {
      rewriteBtn.disabled = false;
      statusMsg.style.color = "red";
      statusMsg.textContent = "❌ 網路或後端錯誤";
    });
  });

  // 清除按鈕
  clearBtn.addEventListener("click", () => {
    inputText.value = "";
    statusMsg.textContent = "";
    clearBtn.disabled = true;
    shareBtn.disabled = true;
    rewrittenText = "";
  });

  // 分享按鈕
  shareBtn.addEventListener("click", () => {
    if (!rewrittenText) return;
    liff.shareTargetPicker([
      {
        type: "text",
        text: rewrittenText
      }
    ]).catch(() => {
      statusMsg.style.color = "red";
      statusMsg.textContent = "❌ 分享失敗或取消";
    });
  });
</script>

</body>
</html>
